create table tabela_final_iptu as
from read_csv('cda_total_iptu_banco_novo.csv')
select * from tabela_final_iptu;
create table tabela_final_iptu as
select * from read_csv('cda_total_iptu_banco_novo.csv');
create table tabela_final_iptu as
select * from read_csv('cda_total_iptu_banco_novo.csv', nullstr='NULL');
select * from tabela_final_iptu;
select numCDA, agrupamento_situacao from tabela_final_iptu limit 10;
describe
;
select numcda, agrupamento_situacao, cod_tipo_pessoa_dam from tabela_final_iptu;
list[3, 4, 5]
;
[3, 4, 5][0]
;
print [3, 4, 5][0]
;
PRINT [3, 4, 5][0];
select [3, 4, 5][0];
select values([3, 4, 5][0]);
VALUES ([3, 4, 5][0]);
SELECT LIST_VALUE(10, 20, 30)[1];
SELECT LIST_VALUE(10, 20, 30)[0];
SELECT LIST_VALUE(10, 20, 30)[2];
exit
;
.open readHistory.csv
select * from open_csv('readHistory.csv')
;
select * from read_csv('readHistory.csv')
;
select * from read_csv('readHistory.csv')
where 1 <> 1;
select * from read_csv('readHistory.csv')
where title like '%dead%';
select * from read_csv('readHistory.csv')
where title like '%computer%';
select * from read_csv('readHistory.csv')
where title like '%live%';
select * from read_csv('readHistory.csv')
where link, title like '%live%';
select link, title from read_csv('readHistory.csv')
where like '%live%';
select link, title from read_csv('readHistory.csv')
where title like '%%';
clear
;
cls
;
clean;
exit
;
from '~/cda.csv'
;
from '~/cda.csv';
from '~/cda_search.csv';
clear
;
.clear
;
.clear
.help
from 'cda_total_iptu_banco_novo.csv';
from read_csv('cda_total_iptu_banco_novo.csv', nullstr='NULL');
.mode json;
.mode json
from read_csv('cda_total_iptu_banco_novo.csv', nullstr='NULL');
.mode table
.qui
.open chess_pipeline
show tables;
.open chess_pipeline.duckdb
show tables;
select * from players_profiles;
select * from main.players_profiles;
select * from maina.players_profiles;
clear
clear
;
select * from main.players_profiles;
describe main.players_profiles;
.mode line
select * from main.players_profiles limit 1;
.quit
show tables;
from games;
from players_games;
from players_games limit 100;
from players_games limit 10;
describe players_games;
select * from read_csv("https://github.com/RulerOf/terraform-csv-example/blob/master/sample.csv");
.shell ls
.shell ~/*csv
.shell ls ~/*csv
select * from read_csv("~/readHistory.csv")
;
create table hn_history as select * from read_csv("~/readHistory.csv");
select * from hn_history;
clear;
summarize hn_history;
from hn_history select *;
clear
;
describe hn_history;
from hn_history select pointsCount;
duckdb -ui
;
exit;
q
;
.help
.databases
.shell yazi
.shell yz
.shell yaiz
.shell yazi
.help
.excel
from hn_history select * limit 10;
.show
create table hn_history as select * from read_csv("~/readHistory.csv");
from hn_history select * limit 10;
.excel
from hn_history select * limit 10;
.shell yazi
.help
clear
;
.help
.exit
describe;
from natureza_divida;
from lamdec.natureza_divida;
.exit
describe extracted_metadata
;
.exit
.exiut
.exit
install nanodbc from community;
load nanodbc;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=ODBC+Driver+17+for+SQL+Server;Server=bravo;Database=pgmconsultaprocesso;Trusted_Connection=yes;'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=ODBC Driver 17 for SQL Server;Server=bravo;Database=pgmconsultaprocesso;Trusted_Connection=yes;', username='sa', password='ufrj#2023'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=bravo;Database=pgmconsultaprocesso;Trusted_Connection=yes;', username='sa', password='ufrj#2023'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67;Database=pgmconsultaprocesso;Trusted_Connection=yes;', username='sa', password='ufrj#2023'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver={ODBC Driver 17 for SQL Server};Server=100.103.195.67;Database=pgmconsultaprocesso;Trusted_Connection=yes;', username='sa', password='ufrj#2023'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;Trusted_Connection=yes;', username='sa', password='ufrj#2023'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;Trusted_Connection=yes;', username='sa', password='ufrj%232023'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;UID=sa;PWD=ufrj#2023;'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;', username='sa', password='ufrj#2023'
) limit 10;
SELECT * FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;UID=sa;PWD=ufrj#2023;', username='sa', password='ufrj#2023'
) limit 10;
SELECT id FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;UID=sa;PWD=ufrj#2023;', username='sa', password='ufrj#2023'
) limit 10;
SELECT id, from_base64(base64encode)  FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;UID=sa;PWD=ufrj#2023;', username='sa', password='ufrj#2023'
) limit 10;
SELECT id, base64encode FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;UID=sa;PWD=ufrj#2023;', username='sa', password='ufrj#2023'
) limit 1;
SELECT id FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;UID=sa;PWD=ufrj#2023;', username='sa', password='ufrj#2023'
) limit 10;
SELECT id, dataAtuacao, numeroFolha FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;UID=sa;PWD=ufrj#2023;', username='sa', password='ufrj#2023'
) limit 10;
SELECT id, dataAutuacao, numeroFolha FROM odbc_scan(
    table_name='documentos',
    connection='Driver=/opt/homebrew/lib/libmsodbcsql.17.dylib;Server=100.103.195.67,1401;Database=pgmconsultaprocesso;UID=sa;PWD=ufrj#2023;', username='sa', password='ufrj#2023'
) limit 10;
.exit
CREATE TABLE TesteOrdenacao (
    valor VARCHAR
);
INSERT INTO TesteOrdenacao VALUES
('0004018BF4AEA82B2E3B1E960D9A7125A6D5C51347282118'),
('00042F09914D23651601E1458FBAECC8D22CC513301A5744'),
('000415A04FD179C5C81B46BB3AE815BF72E5C513085D5742'),
('000413737B6804A936BBFD473A8E3685E0CFC51364183838'),
('00042DFD10B50023C3199B321ADC37185C71C514030A530B'),
('00030CF709320709190C6CFBEB79C9B0E0D455A1C35D5A3E'),
('00041A4B6E2D3225CD1866339B1A788338D6C51427492E2A'),
('000415BBD5B78E4536E0CFCD0BA582539750C514240E595B');
SELECT valor FROM TesteOrdenacao ORDER BY valor;
delete from TesteOrdenacao;
INSERT INTO TesteOrdenacao VALUES
('abc'), ('ABC'), ('ábaco'), ('abaco'), ('ábÁco'), ('çebra'), ('Zebra'), ('zebra'),
('Ångström'), ('ångström'), ('apple'), ('APPLE'), ('Éclair'), ('eclair'),
('1apple'), ('10apple'), ('02apple'), ('_underscore'), ('-dash'), (' space');
from TesteOrdenacao order by valor;
from TesteOrdenacao select strip_accents(valor).lower() order by value;
from TesteOrdenacao select strip_accents(valor).lower() order by valor;
from TesteOrdenacao select lower(valor).strip_accents() order by valor;
from TesteOrdenacao select strip_accents(valor).lower() order by valor;
from TesteOrdenacao select strip_accents(valor).lower() order by valor asc;
from TesteOrdenacao select valor order by valor.strip_accents().lower() asc;
from TesteOrdenacao select valor order by valor.lower().strip_accents() asc;
.exi
from extracted_metadata;
from extracted_metadata where creator ilike '%word%' order by page_count desc;
.exit
install postgres;
load postgres;
ATTACH 'dbname=postgres user=postgres host=127.0.0.1' AS db (TYPE postgres, READ_ONLY);
from extracted_metadata where creator ilike '%word%' order by page_count desc;
from extracted_metadata where creator ilike '%word%' order by page_count desc limit 10;
from extracted_metadata select id where creator ilike '%word%' order by page_count desc limit 10;
from extracted_metadata where id like '%1710238739%';
.exit
history
;
exit
./;;
.excel
.exit
.help
.exit
from file
;
clear
;
describe file;
from file
select addedToHistoryAt;
summarize file;
from file select count(*);
from '~/Documents/cda_total_iptu_banco_antigo.csv';
describe file;
summarize file;
set nullstr = 'NULL';
.help
.exit
create table tf as from read_csv('~/Documents/cda_total_iptu_banco_antigo.csv', nullstr='NULL');
summarize tf;
from tf select count(*);
summarize tf;
explain summarize;
explain summarize 
;
.clear
clear
;
describe tf;
from tf select numCDA where agrupamento_situacao = 0;
from tf select numCDA where agrupamento_situacao = 'Cancelada' limit 100;
from tf select numCDA where agrupamento_situacao = 'Cancelada';
describe tf;
.exit
from file;
describe fiel;
describe file;
.exit
describe file;
summarize file;
from file
select distinct 'Loan Status';
from file
select distinct Loan Status;
from file
select distinct "Loan Status";
from file
select distinct "Loan Duration";
describe file;
from file
select count(*);
from file limit 100;
from file 
select "Currency of "
limit 100;
from file 
select "Currency of Commitment"
limit 100;
from file 
select "Currency of Commitment"
where "Currency of Commitment" is not null
limit 100;
from file 
select "Currency of Commitment"
order by desc;
from file 
select curr:"Currency of Commitment"
order by curr desc;
describe file;
from file 
select curr:"Original Principal Amount (US$)"
order by curr desc;
from file 
select curr:"Original Principal Amount (US$)"
where curr = 0;
summarize file;
.help
start_ui()
;
call start_ui();
copy (from 'column_details_ibrd_statement_of_loans_and_guarantees_latest_available_snapshot_06-07-2025.xlsx') to 'column_descriptions.csv' (header, delimiter '')
copy (from 'column_details_ibrd_statement_of_loans_and_guarantees_latest_available_snapshot_06-07-2025.xlsx') to 'column_descriptions.csv' (header, delimiter ',');
.shell ls
from 'column_descriptions.csv';
describe 'column_descriptions.csv';
.exit
from 'ibrd_loans.csv'
select "Region", "Original Principal Amount";
from 'ibrd_loans.csv'
select "Region", "Original Principal Amount (US$)";
from 'ibrd_loans.csv'
select "Region", "Original Principal Amount (US$)"
group by Region
order by "Original Principal Amount (US$)";
from 'ibrd_loans.csv'
select Region, amount:sum(isnull("Original Principal Amount (US$)", 0))
group by Region
order by amount desc;
from 'ibrd_loans.csv'
select Region, amount:sum(coalesce("Original Principal Amount (US$)", 0))
group by Region
order by amount desc;
summarize 'ibrd_loans.csv'
;
from (summarize 'ibrd_loans.csv')
select column_name, null_percentage;
from (summarize 'ibrd_loans.csv')
select column_name, null_percentage
order by null_percentage;
from (summarize 'ibrd_loans.csv')
select column_name, null_percentage, unique
order by null_percentage;
summarize 'ibrd_loans.csv';
call start_ui();
.exit
call start_ui();
from file
select "Country / Economy Code", "Loan Number";
from file
select "Borrower", "Loan Number";
from file limit 10;
.exit
from (summarize 'ibrd_loans.csv')
select column_name, null_percentage, unique
order by null_percentage;
from 'ibrd_loans.csv'
select Region, amount:sum(coalesce("Original Principal Amount (US$)", 0))
group by Region
order by amount desc;
call start_ui();
describe file;
summarize file;
from file
limit 5;
from file
select anomes_emissao
order by anomes_emissao desc;
describe file;
from file
select cpf_cnpj;
from file
select cpf_cnpj
where len(cpf_cnpj) > 11;
from file
select cpf_cnpj
where length(cpf_cnpj) > 11;
from file
select cpf_cnpj
where length(file.cpf_cnpj) > 11;
from file
select cpf_cnpj
where length(file."cpf_cnpj") > 11;
from file
select int(cpf_cnpj);
from file
select int("cpf_cnpj");
from file
select int::"cpf_cnpj");
from file
select "cpf_cnpj"::int;
from file
select "cpf_cnpj"::bigint;
from file
select cc:("cpf_cnpj"::bigint)
where len(cc::text) > 11;
from file
select cc:("cpf_cnpj"::bigint)
where len(cc::text) < 12;
from file
select cc:("cpf_cnpj"::bigint)
where len(cc::text) > 11;
from file
select cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11;
from file
select cc:("cpf_cnpj"::bigint)
where len(cc::text) > 11;
from file
select cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select "cpf_cnp"
select "gay"[-1];
select "gay"::text[-1];
select "gay"::text[1];
select 'gay'[1];
select 'gay'[-1];
select 'gay'[-1:-2];
select 'gay'[-1:1];
select 'gay'[-2];
select 'gay'[-2:-1];
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3];
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3]
order by matriz_filial asc;
call start_ui();
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3]
order by cpf_cnpj, matriz_filial asc;
from file where length("cpf_cnpj") < 14;
from file
select cc:("cpf_cnpj"::bigint)
where len(cc::text) > 11;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3]
order by cpf_cnpj, matriz_filial asc;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select cpf_cnpj, matriz_filial:"cpf_cnpj"[-6:-3]
order by cpf_cnpj, matriz_filial asc;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3], qtd_matriz_filial:count(matriz_filial)
group by matriz_filial
order by matriz_filial asc;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3], qtd_matriz_filial:count("matriz_filial")
group by matriz_filial
order by matriz_filial asc;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3], qtd_matriz_filial:count("cpf_cnpj"[-6:-3])
group by matriz_filial
order by matriz_filial asc;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select cpf_cnpj, tam_cpf_cnpj:len("cpf_cnpj"), matriz_filial:"cpf_cnpj"[-6:-3]
order by cpf_cnpj, matriz_filial asc;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3], qtd_matriz_filial:count("cpf_cnpj"[-6:-3]), tam_cpf_cnpj:any(len("cpf_cnpj"))
group by matriz_filial
order by matriz_filial asc;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 11)
select matriz_filial:"cpf_cnpj"[-6:-3], qtd_matriz_filial:count("cpf_cnpj"[-6:-3]), tam_cpf_cnpj:any_value(len("cpf_cnpj"))
group by matriz_filial
order by matriz_filial asc;
from (from file
select cnpj:"cpf_cnpj"
where len(cpf_cnpj::bigint::text) > 11)
where cnpj[-6]
from (from file
select cnpj:"cpf_cnpj"
where len(cpf_cnpj::bigint::text) < 12)
where cnpj[-6:-3]  '0022';
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 12)
select matriz_filial:"cpf_cnpj"[-6:-3], qtd_matriz_filial:count("cpf_cnpj"[-6:-3]), tam_cpf_cnpj:any(len("cpf_cnpj"))
group by matriz_filial
order by matriz_filial asc;
from (from file
select cpf_cnpj, cc:("cpf_cnpj"::bigint)
where len(cc::text) < 12)
select matriz_filial:"cpf_cnpj"[-6:-3], qtd_matriz_filial:count("cpf_cnpj"[-6:-3]), tam_cpf_cnpj:any_value(len("cpf_cnpj"))
group by matriz_filial
order by matriz_filial asc;
from (from file
where len(cpf_cnpj::bigint::text) < 12)
where cpf_cnpj[-6:-3]::int > 25;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf_cnpj::bigint::text) < 12)
where cpf_cnpj[-6:-3]::int > 25)
from cpfs;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len("cpf_cnpj"::bigint::text) < 12)
where cpf_cnpj[-6:-3]::int > 25)
from cpfs;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f"cpf_cnpj", NULL) as cnpj
    ,anomes_emissao::    
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f"cpf_cnpj", NULL) as cnpj
    ,anomes_emissao::varchar[:3]::int as ano_emissao
    ,anomes_emissao::varchar[4:]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,anomes_emissao::varchar[:3]::int as ano_emissao
    ,anomes_emissao::varchar[4:]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,anomes_emissao::varchar[-:3]::int as ano_emissao
    ,anomes_emissao::varchar[4:-]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,anomes_emissao::varchar[-:3:-]::int as ano_emissao
    ,anomes_emissao::varchar[4:-:-]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,anomes_emissao::varchar[:3:-]::int as ano_emissao
    ,anomes_emissao::varchar[4:-:-]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,anomes_emissao::varchar[0:3:-]::int as ano_emissao
    ,anomes_emissao::varchar[4:-:-]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3:-]::int as ano_emissao
    ,anomes_emissao::varchar[4:-:-]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3]::int as ano_emissao
    ,anomes_emissao::varchar[4:-:-]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpfs = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3]::int as ano_emissao
    ,(anomes_emissao::varchar)[4:]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(cpfs.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3]::int as ano_emissao
    ,(anomes_emissao::varchar)[4:]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    cpfs.cpf as cpf
    ,if(c.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3]::int as ano_emissao
    ,(anomes_emissao::varchar)[4:]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    c.cpf as cpf
    ,if(c.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3]::int as ano_emissao
    ,(anomes_emissao::varchar)[4:]::int as mes_emissao
    ,qtde_notas
    ,soma_base_calculo::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    c.cpf as cpf
    ,if(c.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3]::int as ano_emissao
    ,(anomes_emissao::varchar)[4:]::int as mes_emissao
    ,qtde_notas
    ,sum_bc::float as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    c.cpf as cpf
    ,if(c.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3]::int as ano_emissao
    ,(anomes_emissao::varchar)[4:]::int as mes_emissao
    ,qtde_notas
    ,sum_bc::double as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    c.cpf as cpf
    ,if(c.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:3]::int as ano_emissao
    ,(anomes_emissao::varchar)[4:]::int as mes_emissao
    ,qtde_notas
    ,replace(sum_bc, ',', '.')::double as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    c.cpf as cpf
    ,if(c.cpf is not null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:4]::int as ano_emissao
    ,(anomes_emissao::varchar)[5:]::int as mes_emissao
    ,qtde_notas
    ,replace(sum_bc, ',', '.')::double as soma_base_calculo;
with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    c.cpf as cpf
    ,if(c.cpf is null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:4]::int as ano_emissao
    ,(anomes_emissao::varchar)[5:]::int as mes_emissao
    ,qtde_notas
    ,replace(sum_bc, ',', '.')::double as soma_base_calculo;
copy (with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    c.cpf as cpf
    ,if(c.cpf is null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:4]::int as ano_emissao
    ,(anomes_emissao::varchar)[5:]::int as mes_emissao
    ,qtde_notas
    ,replace(sum_bc, ',', '.')::double as soma_base_calculo) to 'notas_fiscais_tratado.csvc' (header, delimiter ',');
copy (with cpfs as (from (from file
select cpf:"cpf_cnpj"
where len(cpf::bigint::varchar) < 12)
where cpf[-6:-3]::int > 25)
from file f
left join cpfs c on c.cpf = f."cpf_cnpj"
select
    c.cpf as cpf
    ,if(c.cpf is null, f."cpf_cnpj", NULL) as cnpj
    ,(anomes_emissao::varchar)[0:4]::int as ano_emissao
    ,(anomes_emissao::varchar)[5:]::int as mes_emissao
    ,qtde_notas
    ,replace(sum_bc, ',', '.')::double as soma_base_calculo) to 'notas_fiscais_tratado.csv' (header, delimiter ',');
.exit
from file;
describe file;
from file where cpf is null and cnpj is null;
from file where cpf is not null and cnpj is not null;
summarize file;
from file
select distinct mes_emissao;
.exit
summarize file;
from file
select "Loan Status";
from file
select ls:"Loan Status", qtd_ls:count("Loan Status");
group by ls
order by qtd_ls desc;
from file
select ls:"Loan Status", qtd_ls:count("Loan Status")
group by ls
order by qtd_ls desc;
from 'column_descriptions.csv';
from 'column_descriptions.csv'
where "Column Name" = 'Loan Status';
describe file;
from file limit 10;
from file select "Country / Economy", "Country / Economy Code" limit 10;
summarize file;
from file
select lt:"Loan Type", qtd_lt:count("Loan Type")
group by lt
order by qtd_lt desc;
summarize file;
create table filtrado as from '~/Downloads/2025-06-14T20_07_26+00_00_kvy8.csv';
summarize filtrado;
from filtrado
select disbursed_amount, 
from filtrado
select disbursed_amount, original_principal_amount
where disbursed_amount != original_principal_amount;
from filtrado
select original_principal_amount, cancelled_amount
where loan_status = 'Fully Cancelled';
from filtrado
select original_principal_amount, cancelled_amount
where loan_status = 'Fully Cancelled' and original_principal_amount != cancelled_amount;
from '~/Downloads/IBRD_Statement_Of_Loans_-_Historical_Data.csv';
from '~/Downloads/IBRD_Statement_Of_Loans_-_Historical_Data.csv'
order by "End of Period";
from '~/Downloads/IBRD_Statement_Of_Loans_-_Historical_Data.csv'
order by "End of Period" desc;
create table ibrd_old as from '~/Downloads/IBRD_Statement_Of_Loans_-_Historical_Data.csv';
create table ibrd_old as from 'code/trabalho_final/ibrd_loans_old.csv';
create table ibrd_old as from 'code/trabalho-final/ibrd_loans_old.csv';
create table ibrd_old as from '~/code/trabalho-final/ibrd_loans_old.csv';
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number;
from filtrado f
where loan_status = 'Fully Disbursed' and last_disbursement_date is not null;
describe filtrado;
from filtrado f
select "closed_date_(most_recent)", last_disbursement_date
where loan_status = 'Fully Disbursed';
from filtrado f
select last_disbursement_date
where loan_status not in ('Effective', 'Approved');
from filtrado f
select last_disbursement_date
where loan_status in ('Effective', 'Approved');
SELECT
  loan_status,
  COUNT(*) AS total,
  SUM(CASE WHEN last_disbursement_date IS NULL THEN 1 ELSE 0 END) AS sem_ultimo_desembolso,
  SUM(CASE WHEN last_disbursement_date IS NOT NULL THEN 1 ELSE 0 END) AS com_ultimo_desembolso
FROM your_loans_table
WHERE loan_status NOT IN (
  'Fully Repaid',
  'Fully Cancelled',
  'Fully Transferred',
  'Terminated',
  'Fully Disbursed'
)
GROUP BY loan_status
ORDER BY loan_status;
SELECT
  loan_status,
  COUNT(*) AS total,
  SUM(CASE WHEN last_disbursement_date IS NULL THEN 1 ELSE 0 END) AS sem_ultimo_desembolso,
  SUM(CASE WHEN last_disbursement_date IS NOT NULL THEN 1 ELSE 0 END) AS com_ultimo_desembolso
FROM filtrado
WHERE loan_status NOT IN (
  'Fully Repaid',
  'Fully Cancelled',
  'Fully Transferred',
  'Terminated',
  'Fully Disbursed'
)
GROUP BY loan_status
ORDER BY loan_status;
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number;
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select io."Cancelled Amount", f.cancelled_amount;
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct io."Cancelled Amount", f.cancelled_amount;
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct *;
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select fls:f.loan_status, ln:io."Loan Number"
where fls != ln;
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select fls:f.loan_status, ln:io."Loan Status"
where fls != ln;
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select fls:f.loan_status, ln:io."Loan Status"
where fls != ln
and ln in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed');
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select fls:f.loan_status, ln:io."Loan Status"
where fls != ln
and ln in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed');
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, fls:f.loan_status, ln:io."Loan Status"
where fls != ln
and ln in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed');
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, fls:f.loan_status, ln:io."Loan Status"
where fls != ln
and ln not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed');
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, ln:io."Loan Status", fls:f.loan_status
where fls != ln
and ln not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed');
from (from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, ln:io."Loan Status", fls:f.loan_status
where fls != ln
and ln not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')) oti
inner join ibrd_old io on oti."Loan Number" = io."Loan Number";
from (from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, ln:io."Loan Status", fls:f.loan_status
where fls != ln
and ln not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')) as oti
inner join ibrd_old io on oti.loan_number = io."Loan Number";
from (from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, ln:io."Loan Status", fls:f.loan_status
where fls != ln
and ln not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')) as oti
inner join ibrd_old io on oti.loan_number = io."Loan Number" and oti.ln = io."Loan Status";
from (from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, ln:io."Loan Status", fls:f.loan_status
where fls != ln
and ln not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed');
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, ln:io."Loan Status", fls:f.loan_status
where fls != ln
and ln not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed');
from ibrd_old
select cln:count("Loan Number")
group by "Loan Number"
having cln > 1; 
summarize ibrd_old;
from ibrd_old
select cln:count("Loan Number")
group by "Loan Number"
having cln > 1; 
from ibrd_old
select "Loan Number", cln:count("Loan Number")
group by "Loan Number"
having cln > 1; 
from ibrd_old
where "Loan Number" = 'IBRD2300';
call start_ui();
from ibrd_old
select "Loan Number", cln:count("Loan Number")
group by "Loan Number"
having cln > 3; 
from filtrado f
inner join ibrd_old io on io."Loan Number" = loan_number
select distinct f.loan_number, ln:io."Loan Status", fls:f.loan_status
where fls != ln
and ln not in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed')
and fls in ('Terminated', 'Fully Repaid', 'Fully Cancelled', 'Fully Transferred', 'Fully Disbursed');
.exit
